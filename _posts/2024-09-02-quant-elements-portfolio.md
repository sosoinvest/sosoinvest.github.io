---
layout: single
title:  "퀀트의 필수 요소 (3/7): 자산배분"
description: 퀀트 투자에 필요한 요소인 자산배분에 대하여 정리하였다.
categories: 투자
tag: [주식,책,퀀트]
toc: true
author_profile: false
header:
 teaser: /images/2024-09-02-quant-elements-portfolio/quant-elements-portfolio-thumbnail.webp
 og_image: /images/2024-09-02-quant-elements-portfolio/quant-elements-portfolio-thumbnail.webp

# sidebar:
#     nav: "docs"
# search: true
---
위험은 줄이고 수익을 높이기 위해서는 자산배분이 필요하다.

{: .notice--primary}
<span style="font-size: 1.25em;">이 글은 [퀀트의 정석] 책에 나오는 자산배분 부분을 정리한 것이다.</span>

[퀀트의 정석](/투자/quant-way-book/)

# 자산배분
오래된 속담으로 "달걀을 한바구니에 담지 마라"는 말이 있다. 영어로 하면 "Don't put all your eggs in one baskets" 이다. 즉, 다양한 자산에 분산투자해야 리스크를 줄일 수 있다는 뜻이다.

## 자산배분이 필요한 이유
자산배분은 투자라는 싸움에서 전투불능의 상태를 방지하기 위한 최소한의 방어막이다. 전투불능 상태를 방어하는 것은 매우 중요하다. 왜냐하면 비율로 따지면 손실과 수익은 비대칭적이기 때문이다. 아래의 표는 손실과 이를 회복하기 위해 올려야하는 수익률을 보여준다. 수치에서 보이듯이 -50% 손실이라면 100%의 수익을 올려야하며 -90%는 1900%, 즉 19배가 올라야 원금을 회복할 수 있다. 여기에 추가로 원금을 회복하는 동안 포기해야하는 기회비용의 손실 또한 발생할 수 있다. 

아래의 표의 수치들은 간단한 수식으로 계산할 수 있다. 만약 x%만큼 손실이 발생했을 때, 이를 회복하기 위한 수익률 y는 아래의 수식으로 표현된다.

$$
y=\frac{1}{1-x/100}
$$

위의 수식으로 회복에 필요한 수익률 y는 x가 커질수록, 즉 분모가 작아질수록 기하급수적으로 늘어나는 것을 이해할 수 있다. x가 100이 되면 어떻게 될까? 이때의 y는 무한대로 발산한다. 물론 x가 0이 되는 경우는 종목이 상장페지되는 것 아니고서는 발생하지 않는다. 

*표 1: 손실을 회복하기 위해 필요한 수익률*

| 손실 | 수익 |
|:---:|:---:|
| -1.00% | 1.01% |
| -5.00% | 5.26% |
| -10.00% | 11.11% |
| -25.00% | 33.33% |
| -50.00% | 100% |
| -75.00% | 400% |
| -90.00% | 900% |
| -95.00% | 1900% |

## 두 자산으로 구성된 포트폴리오의 수익률과 변동성
먼저 간단한 두 자산으로 구성된 포트폴리오의 수익률과 변동성의 관계를 보자. 어떤 A와 B라는 자산이 있다고 할 때, 이 자산들의 수익률(R)은 평균($\mu$)과 표준편차($\sigma$)를 갖는 랜덤변수, 즉, $R\sim(\mu,\sigma)$ 로 생각해볼 수 있다.

이 두개의 자산을 혼합하여 포트폴리오를 만들면, 이 포트폴리오의 수익률은 각각의 랜덤변수들의 가중합(Weighted Summation)으로 다음과 같이 표현된다.

$$ 
R_{AB}=W_AR_A+W_BR_B
$$

여기서 $R_P$는 포트폴리오의 수익률, $W$는 가중치를 의미한다.

평균의 정의를 따라가면 전체 포트폴리오의 수익률의 평균은 단순히 두 확률변수의 평균의 합으로 표현된다. 즉, 포트폴리오의 수익률은 A와 B에 대하여 선형이다.

$$ 
\mu_{AB} = W_A \mu_A + W_B \mu_B
$$

반면에 포트폴리오의 변동성을 나타내는 표준편차는 이보다 복잡하다. 표준편차는 분산의 제급근이므로 분산의 정의에 따라서 포트폴리오의 표준편차 $\sigma_{AB}$를 계산해보면,

$$
\sigma_{AB} = \sqrt{\sigma_A^2W_A^2+\sigma_B^2W_B^2+2W_AW_B\sigma_A\sigma_B\rho_{AB}} 
$$

여기서, $\rho_{AB}$ 는 두 자산간의 상관계수로, 다음과 같이 공분산($Cov(A,B)$)을 표준편차의 곱으로 나눈 것으로 정의된다.

$$
\rho_{AB} = \frac{Cov(A,B)}{\sigma_A \sigma_B}
$$

$$
Cov(A,B) = \frac{1}{n}\sum_{i=1}^{n} (R^A_i-\mu_A)(R^B_i-\mu_B)
$$

공분산과 상관계수 식을 자세히 들여다보면, 결국 수익률 벡터를 평균만큼 이동시켜서 서로 내적한 것이라고 볼 수 있다. 두 벡터가 같은 방향을 가리키면 양수, 반대 방향을 가리키면 음수, 서로 직교하면 0이 된다. 상관계수는 벡터의 내적인 공분산을 -1부터 1사이의 값을 갖도록 정규화한 것에 불과하다. 즉, 상관계수의 의미는 벡터의 방향으로서도 이해할 수 있다.

위의 포트폴리오의 표준편차 수식은 표준편차의 제곱항이 들어간다. 따라서 비선형이다. 때문에 표준편차는 포트폴리오의 변수 $W_A$와 $W_B$에 대하여 곡선의 형태를 띄게된다. 이 말은 다시 생각해보면 주어진 조건에서 표준편차를 최소화하는 가중치 $W_A$와 $W_B$가 존재한다는 것이다.

예를 들어서 A와 B의 평균 수익률과 표준편차가 아래의 표와 같다고 해보자. 일반적으로 포트폴리오 이론에서는 표준편차를 변동성이라고 표현하기 때문에 여기서 부터는 변동성이라는 용어를 쓰겠다. 

| 자산 | 수익률 | 변동성 |
|:---:|:---:|
| A | 4% | 10% |
| B | 6% | 14% |

A와 B로 구성된 포트폴리오의 수익률과 변동성(즉, 표준편차)을 평면위에 그리면 다음과 같다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-theory.webp" alt="포트폴리오 이론을 설명하는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 1 두개의 자산으로 구성된 포트폴리오의 수익률과 변동성; 여기서 수익률을 포트폴리오의 평균 수익률을 의미하며 변동성은 포트폴리오의 표준편차이다.</span>
</p>

위의 그림은 가중치에 따라서 수익률과 변동성이 A에서 B방향으로 이동하는 것을 볼 수있다. 신기한 점은 두 자산의 상관관계가 1이라면 그래프가 직선으로 나타난다는 것이다. 즉, 포트폴리오의 표준편차 공식에서 제곱근 안의 항들이 제곱 형태로 표현되어서 제곱근이 벗겨지므로 선형이 된다는 것이다. 따라서 분산투자의 효과는 발생하지 않는다.

반대로 상관관계가 0이라면 그래프는 곡선의 형태로 나타나는데 흥미로운 점은 같은 변동성이라도 가중치에 따라 수익률이 달라질 수 있다는 것이다. 곡선에 수직으로 선을 그어보면 만나는 점이 두개가 존재하는데 위의 점의 가중치에 따라 포트폴리올르 구성하면 아래 점과 변동성은 같으면서 수익률은 높일 수 있다 .

상관관계가 -1이라면 변동성을 0에 가깝게 만들 수도 있다. 거의 무위험 수익을 올리는 것이다. 그러나 현실에서는 상관관계가 정확히 -1이 되는 자산들이 존재하지 않기 때문에 무위험 수익에 대한 기대는 안하는게 좋다.

위의 그림이 보여주는 것은 포트폴리오 이론을 이용하면, 상관계수에 따라서 같은 수익률을 더 낮은 변동성에서 얻을 수 있거나, 같은 변동성에서 수익률을 최대화하는 기회가 생긴다는 것이다. 자산배분이 효력을 발휘하는 이유는 바로 이때문이다. 즉, 낮은 상관계수를 갖는 자산들로 포트폴리오를 구성하면 단일 자산만을 보유한 것보다 더 낮은 위험으로 더 나은 수익을 낼 수 있다는 것이다. 

여기서 가장 중요하지만 어려운 것은 상관계수다. 상관계수가 1이라면 수익률과 변동성이 모두 선형이기 때문에 이러한 효과가 나타나지 않는다. 전통적인 주식-채권 포트폴리오가 주식과 채권이라는 두 자산으로 구성되어 있는 이유는 바로 이 두 자산군인 주식과 채권이 역사적으로 낮은 상관계수를 유지해왔기 때문이다. 

아래의 그림은 미국 주식과 채권 수익률의 역사적 상관관계를 보여준다. 여기서 채권 수익률은 채권 가격과 반대의 관계를 갖기 때문에, 상관관계도 반대다. 즉, 그림에서 (+)는 채권 가격과 주식이 음(-)의 상관관계를 갖는 것을 의미하며, (-)는 반대로 채권 가격과 주식이 양(+)의 상관관계를 갖는 것을 의미한다.

2000년 이전에는 주식과 채권가격이 약한 음의 상관관계가 있었다. 그러나 2000년 이후 특히, 2008년 금융위기 이후로는 주식과 채권가격이 같이 움직이는 강한 양의 상관관계를 갖는 것으로 변하였다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/stock-bond-correlation.webp" alt="주식-채권의 상관계수를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 2 주식-채권의 역사적 상관계수; 2000년대 들어와서 이전에는 없던 양의 상관관계가 생기는 모습이다. (출처: ipe.com)</span>
</p>

# 포트폴리오 이론
상관계수와 분산투자의 효과에 대한 아이디어는 1952년 경제학자 해리 마코위츠(Harry Markowitz)에 의해 세상에 알려지게 되었다. 그는 1952년 자신의 박사학위 논문을 통해 처음으로 포트폴리오 최적화에 대한 생각을 제시했다. 그는 이러한 공로를 인정받아 1990년에 노벨 경제학상을 수상한다.

## 효용함수
마코위츠의 포트폴리오 이론에서 투자자의 효용(Investor's Utility)을 수익률(Expected Return)에서 위험 회피 성향(Risk Aversion)과 변동성(Volatility)의 곱을 뺀 것으로 아래와 같이 정의한다.

$$
Investor's\ Utility = Expected\ Return - Risk\ Adversion \times Volatility
$$

이 함수는 어떤 포트폴리오에서 투자자가 원하는 수익과 원치않는 변동성 수준간의 트레이드 오프 관계를 잘 보여준다. 즉, 효용을 증가시키기 위해서는 기대 수익률을 높일 수 있는 동시에 포트폴리오의 변동성을 낮출 수 있는 자산군별 가중치 값들을 찾아야 한다. 여기서 위험 회피 성향은 변동성의 가중치를 결정하는 파라미터다.

해리 마코위츠는 효용 함수의 최대화가 바로 포트폴리오의 목적이라고 말했다.

## 평균 분산 최적화 (MVO)
해리 마코위츠는 상관계수가 낮은 자산들을 하나의 포트폴리오 안에 구성한다면 가능한 수익을 높이면서 위험은 낮추는 포트폴리오를 만들 수 있다고 주장했다. 다시말해, 위험 대비 수익이 가장 높은 포트폴리오를 만드는 것이 해리 마코위츠가 논문에서 말하고자 했던 것이다. 이러한 최적화 방식을 우리는 평균 분산 최적화(MVO, Mean Variance Optimization)라고 한다. 

MVO는 포트폴리오의 수익률인 평균과 위험 지표인 분산 사이의 트레이드 오프 관계에서 가장 최적의 위치를 찾는 것을 목표로 한다. 이를 가중치 $W$를 구하는 최적화 문제로 표현하면,

$$
\underset{W}{Max.} \ \mu_{P}-a\sigma_P
$$

여기서 a는 위험 회피 성향을 나타내는 계수이다. 이 최적화 문제는 수학적 최적화 방법으로 풀 수 있다. 예를 들면, 기울기 기반 방법으로는 sequential linear programming(SLP), sequential nonlinear programming(SQP), simplex method(SM) 등이 있고, 전역탐색 방법은 genetic algorithm(GA)과 simulated annelaing(SA)이 있다. 다른 수학 문제들에 비해 모델이 단순해서 기울기 기반 방법을 사용해도 충분할 것 같다.

일반적으로 MVO는 두단계로 이루어진다. 첫번째는 모델에 들어갈 입력변수 값을 추정하는 것이고, 다른 하나는 이러한 입력변수를 기반으로 최적화 알고리즘을 통해 최적의 가중치를 찾아내는 것이다. 

위의 최적화 문제에서 위험 회피 성향이 고정이라고 가정한다면, 여기서 추정해야하는 입력변수는 자산들의 기대 수익률과 변동성, 그리고 각 자산들 간의 상관계수다. 만약 자산이 3개 이상이라면 변동성과 상관계수를 하나로 결합한 공분산 행렬로 표현할 수 있다.

### 효율적 경계선
효율적 경계선은 현재 상황과 조건에서 만들 수 있는 포트폴리오의 모든 경우의 수 중에서 동일한 위험 대비 가장 높은 수익률을 제공하거나 동일한 수익률 대비 가장 낮은 수준의 위험을 제공하는 포트폴리오들의 집합을 하나의 선으로 연결한 것을 의미한다.

### MVO의 한계
현실적 으로 MVO 모델은 그대로 사용하기에는 한제가 있다. 그 이유는 모델이 요구하는 입력변수가 매우 많기 때문이다. MVO 모델의 입력변수로는 기대 수익률과 변동성, 그리고 상관계수에 대한 값이 필요한데, 이러한 값을 정확히 알기란 거의 불가능하다. 과거의 데이터를 기반으로 추정한다고 해도 미래에는 바뀔 수 있기 때문이다.

만약 입력변수의 추정치가 조금이라도 바뀌는 경우 가중치가 급격하게 변하거나 여러 자산 중 소수의 자산에만 가중치가 집중되는 이른바 코너해(Corner Solution) 현상이 발생한다. 여기에 더해서 엄밀히 말하면 실제 세상에서의 수익률 분포는 전통적인 자산배분 모델이 가정하고 있는 정규 분포를 따르지 않는다. 따라서 포트폴리오의 평균과 표준편차 공식을 실제 데이터에 대입하면 맞지 않는 경우가 발생할 수 있다.

정리하면 MVO 모델은 그것이 가정하고 있는 것들이 현실적으로 맞지 않기 때문에 가정이 잘못된 모델을 현실 세계에서 그대로 사용하고 있는 셈이었다. 이는 최적화 기법이 종종 우리의 예상과는 다르게 사후적으로 예상보다 좋지 못한 결과를 가져다 줄 수 있다는 것을 의미한다. 또한 이는 최고의 성과를 만들어줄 수 있는 유일무이한 기법은 존재하지 않는 다는 것을 의미하기도 한다. 

결국 MVO 모델의 한계가 알려지게 되면서 사람들은 이를 어떻게 개선할 수 있을 것인가에 대해 생각하게 되었고, 이후 세상에는 여러 가지 형태의 포트폴리오 최적화 모델이 나오게 된다. 여기에 더해서 실무적 레벨에서의 포트폴리오 최적화는 자산간의 가중치를 결정하는 횡적 배분모델과 포트폴리오와 현금의 비율을 결정하는 종적 배분모델의 결합으로 발전했다.

### 횡적 배분모델: 분산투자
횡적 배분 모델은 MVO의 확장이며, 우리가 일반적으로 생각하는 투자 포트폴리오를 의미한다. 즉, 횡적 배분모델은 어떤 자산에 얼마만큼의 가중치로 투자할 것인지를 결정하는 알고리즘이다.

#### 동일비중 모델
동일비중 모델은 가장 단순한 형태의 횡적 배분 모델로 모든 자산을 같은 비율(=$1/n$)로 투자하는 방식이다. 이 방식의 장점은 입력변수에 대한 아무런 추정이 필요하지 않기 때문에 추정오차라는 것이 발생하지 않는다는 것이다. 동일비중 모델에 들어가는 입력변수는 오로지 자산의 개수 뿐이다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-equal.webp" alt="동일비중 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 3 동일비중 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

일반적으로 동일비중 모델은 다른 모델보다 상대적으로 더 높은 위험을 가져간다. 그 이유는 변동성에 상관 없이 모든 자산에 자금을 골고루 배분하기 때문이다.

#### 최대 샤프비율(MSR) 모델
최대 샤프비율(MSR, Maximum Sharpe Ratio)을 추구하는 최적화 모델은 수익률은 높이고 변동성은 최소화하기 때문에 결국 MVO 그 자체다. 다만 여기서는 위험 회피 성향이 고려되지 않으며, 단순히 시장 포트폴리오와 같이 무위험 수익률이 존재할 때의 샤프비율을 최대화한다. 

$$
\underset{W}{Max.} \ SR_{P}=\frac{\mu_P-r_f}{\sigma_P}=\frac{\mathbf{W}^T\mathbf{\mu}}{\sqrt{\mathbf{W}^T\mathbf{\Sigma}\mathbf{W}}}
$$

여기서 $SR_P$는 포트폴리오의 샤프비율, $r_f$는 무위험 수익률, $\mathbf{W}$은 가중치 벡터, \mathbf{\Sigma}는 공분산 행렬을 의미한다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-MSR.webp" alt="최대 샤프비율 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 4 최대 샤프비율 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

최대 샤프비율 모델은 횡적배분 모델중에서 가장 많은 수의 입력변수를 요구한다. 따라서, 입력변수의 변화에 굉장히 민감하게 반응하며, 그만큼 포트폴리오의 회전율 또한 높다.


#### 글로벌 최소분산(GMV) 모델
글로벌 최소 분산(GMV, Global Minimum Variance) 모델은 오직 변동성의 최소화를 목적으로 한다. 즉, 이는 MVO에서 위험회피 계수가 매우 큰 경우로 볼 수 있다. 이 경우의 최적화 모델은 오직 변동성을 낮추는 데만 집중하게 되고, 따라서 최종적으로 가장 낮은 변동성의 포트폴리오를 구성할 수 있도록 가중치 해를 찾는다.

$$
\underset{W}{Min.} \ \sigma_P = \sqrt{\mathbf{W}^T\mathbf{\Sigma}\mathbf{W}}
$$

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-GMV.webp" alt="글로벌 최소분산 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 5 글로벌 최소분산 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

#### 최대 분산효과(MDP) 모델
최대 분산효과 모델(MDP, Most Diversified Portfoli)은 분산비율(DR, Diversified Ratio)이라고 하는 것의 최대화를 추구한다. 여기서 분산비율은 자산들의 변동성을 포트폴리오 전체의 변동성으로 나눈 비율이다.

$$
\underset{W}{Max.} \ DR=\frac{\mathbf{W}^T\sigma}{\mathbf{W}^T\mathbf{\Sigma}\mathbf{W}}
$$

이 분산비율에서 분자와 분모의 차이를 결정하는 것은 결국 상관계수다. 분자 부분을 계산하기 위해서는 상관계수가 필요 없지만, 반대로 분모 부분인 포트폴리오 분산을 계산하기 위해서는 상관계수가 필요하다. 분산비율을 최대화 하려면 분모가 작아져야 한다. 즉, 이는 상관계수가 낮은 자산들로만 포트폴리오를 구성하겠다는 의미다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-MDP.webp" alt="최대 분산효과 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 6 최대 분산효과 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

#### 리스크 패러티(RP) 모델
MOV가 가진 입력변수 추정오차의 한계에 대한 대안으로 제시한 것이 바로 위험 에산 배분(Risk Bugetting)이라는 개념이다. 위험 예산 배분이란 간단히 말해서 각각의 자산군에 적절한 위험 예산, 즉 위험의 정도를 배분하고 이러한 위험 예산 배분에 의거하여 각각의 가중치를 설정하는 방법이다. 예를 들어, 전체 포트폴리오 위험의 10%를 원자재에 50%를 주식에 배분한다고 하면, 이러한 위험 예산의 할당치에 맞게 포트폴리오의 가중치를 정하는 방식이다.

위험 예산 방식은 포트폴리오 전체 위험이 한가지 자산이나 혹시 몇가지 상관성이 높은 자산군으로 쏠리는 것을 방지하기 위해 사용된다. 가령, 주식과 채권에 각각 60대 40의 비율로 투자하는 전통적인 60/40 포트폴리오는 위험 예산 방식에 의하면 매우 위험한 포트폴리오라고 볼 수 있다. 왜냐하면 채권보다 위험한 주식에 60%를 투자하면 실질적으로 포트폴리오 전체 위험에서 주식이 가져가는 위험의 정도가 90%에 이르기 때문이다. 따라서 이러한 배분 방시근 당연하게도 포트폴리오를 엄청난 주식 테일 리스크(Tail Risk)에 노출되게 만든다.

만약 주식, 채권으로 포트폴리오를 구성해야 한다면, 위험 예싼 배분 기법은 위험 예산의 관점에서 보다 균형 잡힌 자산배분을 위해 주식에는 보다 낮은 가중치를, 채권에는 보다 높은 가중치를 부여할 것이다. 

여기서 다루는 리스크 패러티(Rp, Risk Parity)모델은 이러한 위험 예산 배분 방식의 한 종류다. 모델의 이름이 내표하듯이 이는 각 자산의 위험 기여도를 동일하게 해주는 포트폴리오를 추구한다. 즉, 포트폴리오 내에서 모든 자산이 기여하는 위험성을 동등하게 해주도록 가중치를 결정하는 모델이다. 다른말로 리스크 패러티는 동등 위험 기여도(ERC, Equal Risk Contribution) 모델이라고도 한다.

$$
\underset{W}{Min.} \ \sum_{i=1}^{N}(w_i\frac{( \mathbf{\Sigma} \mathbf{W})_i}{\sigma_P^2}-1/N)^2
$$

여기서 $N$은 자산의 개수를 의미한다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-RP.webp" alt="리스크 패러티 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 7 리스크 패러티 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

#### 동등한계변동성(EMV) 모델
리스크 패러티 개념과 함께 위험 예산 배분 방식의 또다른 케이스로 동등한계변동성(EMV, Equal Marginal Volatility) 기법이 있다. 이 모델은 기본적으로 개별 자산들의 변동성 만을 고려해서 위험 예산을 배분하는 방식이다. 따라서 이는 리스크 패러티와 다르게 자산간의 상관계수에 의해 발생하는 포트폴리오 변동성에 대한 영향은 고려하지 않는다.

결국 단순히 변동성이 높은 자산에는 낮은 가중치를, 반대로 변동성이 낮은 자산에는 높은 가중치를 부여하는 것이 이모델의 특징이다. 변동성에 반비례하여 투자 가중치를 결정하기 때문에 이 모델은 종종 역변동성(IV, Invers Volatility) 모델이라고도 불린다. 이 모델의 또다른 특징은 각 자산의 변동성만을 고려하기 때문에 가중치를 결정하기 위해 알고리즘을 거칠 필요가 없다는 것이다. 각 자산의 변동성 수준만을 안다면 아래의 수식에 의해 가중치를 쉽게 계산할 수 있다.

$$
w_i=\frac{1/\sigma_i}{\sum_{i=1}^{N}1/\sigma_i}
$$

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/portfolio-EMV.webp" alt="동등한계변동성 모델의 수익률과 가중치를 보여주는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 8 동등한계변동성 모델의 수익률과 가중치 이력 (출처: 퀀트의 정석)</span>
</p>

#### 블랙-리터만 모델
블랙-리터만 모델은 1990년 피셔 블랙과 로버트 리터만에 의해 처음 제시된 포트폴리오 최적화 모델이다. 블랙-리터만 모델은 다른 모델들과는 다른 주요한 특징이 있는데, 그것은 바로 가중치를 결정함에 있어 현재 시장에 내재되어 있는 정보와 미래 시장 상황에 대한 투자자의 주관적인 뷰를 결합하여 사용한다는 점이다. 시장이 제시하는 정보와 투자자의 뷰의 결합은 최종적으로 새로운 기대 수익률과 공분산 추정치를 만들어내고 이는 다시 MVO 모델의 입력변수로 들어간다.

블랙-리터만 모델은 총 네 단계의 과정을 거쳐야 한다.
1. 사전 기대 수익률 분포 정의
2. 기대 수익률에 대한 투자자의 뷰 설정
3. 투자자 뷰에 기반한 사후 기대 수익률 분포 결정
4. 블랙-리터만 최적 포트폴리오 가중치 산출

불짝 리터만 모델을 사용하기 위한 첫번째 과정은 현재의 시장 포트폴리오 가중치로부터 시장에 녹아있는, 즉 시장이 생각하는 기대 수익률 수준을 역산하는 것이다. 이 과정은 리버스 엔지니어링이라 부르며, 시장이 기대하는 수익률에 대한 사전적 분포를 알아내기 위함이다.

두번째 단계는 각 자산별 절대적 혹은 상대적 성과에 대한 자신만의 주관적인 뷰를 수치적으로 구체화해야 한다. 이는 시장 포트폴리오를 기반으로 투자자의 뷰가 가미된 액티브 포트폴리오를 구성하기 위함이다.

세번째 단계는 이 둘을 결합하여 포트폴리오 수익률에 대한 사후 분포를 산출하는 것이다. 이렇게 산출된 사후 분포를 통해 우리는 시장 뷰와 투자자의 뷰가 결합되어 새롭게 업데이트된 기대 수익률 벡터와 공분산 행렬을 구할 수 있으며, 이것들이 또다시 MVO 모델의 입력변수로 들어가게 되면 최종적인 투자 가중치가 나오게 된다.

### 종적 배분모델: 자금관리
종적 배분모델은 전체 가용자본 중에서 얼마만큼을 내가 정한 자산 배분 포트폴리오에 투자할 것인가를 결정하는 알고리즘이다. 즉, 포트폴리오에서 현금 비중을 정하는 방식이라고 할 수 있다. 

포트폴리오에 현금을 추가하면 손실에 대한 일종의 쿠션 역할을 한다. 예를ㄷ르어, 만약 포트폴리오가 10% 손실을 보더라도 내가 해당 포트폴리오에 전체 자금의 절반만을 투자했다면 현금을 포함한 전체 포트폴리오의 손실은 5%가 된다. 대부분의 전설적인 투자자나 트레이더 들은 모두 자금관리가 메우 중요하다고 말했는데, 여기서 말하는 자금관리가 바로 종적 배분모델이다.

#### 변동성 타게팅
변동성 타게팅은 전체 포트폴리오의 변동성을 일정 레벨로 유지하고자 하는 경우에 사용하는 종적 배분모델이다. 모델의 이름 그대로 투자자가 목표로 하는 변동성 수준을 맞추기 위해 매 시점마다 주기적으로 현금 보유비중을 조절한다. 만약 목표 변동성이 5%라고 한다면 포트폴리오의 변동성이 계속해서 5%를 달성할 수 있도록 자산 포트폴리오의 변동성이 커지는 경우 현금 보유 비중을 늘리게 되며, 반대로 변동성이 작아지는 경우 현금을 더 적게 가져간다.

이 방식은 위험 조정 수익률 관점에서 롱온리 포트폴리오보다 더 나은 결과를 보여주기도 한다. 그 이유는 위험 자산의 성과와 변동성은 일반적으로 음(-)의 상관관계를 지니고 있기 때문이다. 변동성이 죽어있는 상태에서 레버리지를 일으키는 반면, 변동성이 커지는 구간에서는 포지션을 줄이도록 설계되어 있다. 이처럼 변동성이 높은 시기에 디레버리징을 하는 것은 테일 리스크를 줄이는 데 효과적이다. 실제로 2008년 글로벌 금융위기 당시에도 이러한 변동성 타게팅은 보다 나은 성과를 보여주었다.

#### CVaR 타게팅
이 모델은 변동성보다 훨신 더 보수적인 위험지표인 CVaR을 사용한다. 여기서 말하는 CVaR이란 Conditional Value-at-Risk의 머리글자로, 시장상황이 최악인 경우 평균적으로 얼마만큼의 손실이 발생할 수 있는가를 측정하는 지표다.  

CVaR 타게팅은 포트폴리오의 CVaR을 항상 목표 수준에 맞추기 위해 현금 보유비중을 결정하는 방법이다. CVaR이라는 위험지표가 변동성보다 훨씬 더 보수적인 지표이기 때문에 일반적으로 CVaR 타게팅의 배팅크기는 변동성 타게팅보다 훨씬 더 작다. 또한 CVaR이 자주 바뀌는 수치는 아니기 때문에 배팅의 회전율도 상대적으로 적다.

#### 켈리 배팅
켈리 배팅은 퀀트의 조상인 에드워드 소프가 물리학자 존 켈리 주니어의 논문으로부터 영감을 받아 고안해낸 배팅 방식이다. 에드워드 소프는 어떻게 하면 카지노에서 승리할 수 있는가를 항상 고심했다. 그가 켈리 배팅이란느 방식을 만들어낸 이유 또한 다음과 같은 문제를 해결하기 위해서였다. 

>확률적 우위를 확보한 게임이 있다고 하자. 그렇다면 이 게임에서 장기적으로 승리하기 위해서는 매순간 과연 얼마만큼의 자본금을 걸어야 하는가?

다시 말해, 전체 자본 중 얼마만큼을 투자할지를 결정하는 알고리즘이 바로 켈리 배팅이다. 결국 이는 자금관리를 어떻게 할 것인가를 결정하기 위한 수학적 솔루션이다. 

켈리 배팅을 도출하기 위해서는 꽤 지난한 과정의 수학적 전개가 필요하지만, 사실 결론만 놓고 보면 아이디어는 꽤나 단순하다. 켈리 배팅이 말하는 최적 배팅 비율은 수익률을 불확실성의 정도인 분산으로 나눈 값이다. 이를 풀어 설명하면 결국 켈리 배팅은 수익을 낼 수는 있지만 그 수익을 낼 수 있는 불확실성의 정도까지를 감안하여 배팅 크기를 결정하라는 것이다. 즉, 내가 돈을 벌 수있단느 확신의 정도가 강해지면 강해질수록 배팅의 크기를 늘리는 것이 결국 캘리 베팅이 말하고자 하는 것이다.

#### 포트폴리오 보험
포트폴리오 보험은 CCPI(Constant Proportional Portfolio Insurance)이라고도 불리며 이는 포트폴리오의 가치가 미리 정한 하단선 아래로 빠지지 않도록 설계된 종적 배분 모델이다. 이 방식은 만약 포트폴리오의 성과가 좋다면 포지션을 늘리고, 반대로 성과가 부진할 때는 노출을 줄임으로써 모델의 목표를 달성한다. 또한 만약 포트포리오의 가치가 미리 정한 하단선에 도달하게 되면, 이 전략은 현금에 100% 가중치를 할당하여 투자원금을 보호한다.

포트폴리오 보험 전략은 포트폴리오의 가치(P)와 하단 기준선(B)의 차이인 쿠션(C), 그리고 레버리지 승수에 의해 정의된다. 포트폴리오에 얼마를 투자할지는 전적으로 이 쿠션과 승수의 곱에 달려있다. 예를들어, 포트폴리오의 가치가 100, 하단 기준선이 80, 승수가 4인 상황이라면 포트폴리오에 대한 초기 가중치는 $4\times(100-80)=80$이 되며, 나머지 20%는 현금을 보유한다. 만약 포트폴리오의 가치가 104로 상승하면, 포트폴리오 보험 전략은 자산 포트폴리오에 보다 높은 가중치를 주게되고, 이떄의 포트폴리오 투자금액은 4(104-80)=96%가 된다. 만약, 최악의 경우 포트폴리오의 가치가 하단 기준선에 도달하게 되면 당연히 쿠션은 0이되고, 이때 모델은 현금 비중을 100% 가져갈 것을 지시한다. 

### 포트폴리오 구성 프로세트
횡적 자산배분과 종적 자산배분을 종합하면, 전체 포트폴리오 구성 과정은 아래와 같이 3단계로 구성된다. 

1. 자산군 선정

2. 횡적 배분 모델 선택

3. 종적 배분 모델 선택

첫번째 단계인 자산군 선정에서는 포트폴리오에 들어갈 자산 또는 종목들, 즉 투자 자산의 풀을 결정한다. 여기서 선정한 자산 풀에 따라서 해당 포트폴리오의 성격이 정해진다

두번째 단계는 바로 어떤 회적 배분 모델을 선택할지 결정하는 것이다. 횡적 배분 모델에 따라 자산군 상에서 각각의 자산들이 어느 정도로 배분될지가 결정된다. 여기서 1차적인 포트폴리오가 완성된다

마지막은 자산 포트폴리오와 현금 간의 비중을 조절하기 위한 종적 배운모델을 선택하는 것이다. 전체 포트폴리오에서 자산과 현금 간의 비중은 시간에 따라 종적 배분 모델에 의해 자동적으로 재계산되어 결정된다.

이러한 포트폴리오 구성 과정을 그림으로 표현하면 다음과 같다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/quant-portfolio-process.webp" alt="포트폴리오 구성을 표현한 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 9 포트폴리오 구성 과정</span>
</p>

자산 배분의 관점에서는 탑다운 방식으로 아래와 같이 표현된다.

<p align="center">   
    <img src="/images/2024-09-02-quant-elements-portfolio/quant-asset-allocation.webp" alt="자산배분 과정을 탑다운으로 표현한 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 10 포트폴리오를 이용한 자산 배분과정 </span>
</p>

## 부록
### 두개의 자산으로 구성된 포트폴리오의 수익률과 변동성
```python
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.ticker import MaxNLocator

mu_A = 4.0
mu_B = 6.0

sigma_A = 10.0
sigma_B = 14.0

W_A = np.linspace(0,1,101)
W_B = 1.0-W_A

mu_AB = mu_A*W_A + mu_B*W_B

rho_AB = 0
sigma_AB = np.sqrt(sigma_A**2*W_A**2 + sigma_B**2*W_B**2 + 2*W_A*W_B*sigma_A*sigma_B*rho_AB)
print(mu_AB)
print(sigma_AB)

fig, ax = plt.subplots(1, 1, figsize=(8, 6), tight_layout=True)
for rho_AB in np.linspace(-1,1,5):
    mu_AB = mu_A * W_A + mu_B * W_B
    sigma_AB = np.sqrt(sigma_A ** 2 * W_A ** 2 + sigma_B ** 2 * W_B ** 2 + 2 * W_A * W_B * sigma_A * sigma_B * rho_AB)
    ax.plot(sigma_AB, mu_AB, label=f"{r"$\rho$"}={rho_AB}")

plt.legend()
ax.grid(True)
ax.set_xlabel("Volatility [%]", fontsize=16, fontname="Times New Roman", color="black")
ax.set_ylabel("Return [%]", fontsize=16, fontname="Times New Roman", color="black")
plt.xticks(fontname="Times New Roman", fontsize=12)
plt.yticks(fontname="Times New Roman", fontsize=12)
ax.set_ylim((4, 6))
plt.tight_layout()
plt.savefig("portfolio.png", dpi=300)
plt.show()
```
