---
layout: single
title:  "퀀트의 필수 요소 (4/7): 팩터 모델링"
description: 퀀트 투자에 필요한 요소인 팩터 모델링에 대하여 정리하였다.
categories: 투자
tag: [주식,책,퀀트]
toc: true
author_profile: false
header:
 teaser: /images/2024-09-04-quant-elements-factor/quant-elements-factor-thumbnail.webp
 og_image: /images/2024-09-04-quant-elements-factor/quant-elements-factor-thumbnail.webp

# sidebar:
#     nav: "docs"
# search: true
---
팩터는 금융 시장에서 수익의 원천이 되는 어떠한 원인 혹은 변수로 정의할 수 있다.

즉, 팩터는 우리 눈에는 보이지 않지만 금융시장을 설명할 수 있는 본질적인 동인이다.

{: .notice--primary}
<span style="font-size: 1.25em;">이 글은 [퀀트의 정석] 책에 나오는 팩터 모델링 부분을 정리한 것이다.</span>

[퀀트의 정석](/투자/quant-way-book/)

# 팩터의 역사

## CAPM과 베타
1964년 윌리엄 샤프는 CAPM(Capital Asset Pricing Model)을 기반으로 베타라는 개념을 만들었다. 여기서 CAPM의 수식은 아래와 같다.

$$
E(R_i) =  R_f + \beta \times [E(R_M)-R_f]
$$

위의 수식에서 $E(R_i)$는 자산 i의 기대수익률, $R_f$는 무위험 수익률, $\beta$는 시장 전체의 움직임에 대한 자산 i의 민감도, 그리고 $E(R_M)$은 시장 전체의 기대 수익률을 의미한다. 수식에서 보이듯이 $\beta$(베타)는 어떤 자산이 시장의 위험에 어느 정도로 노출되어 있는가를 측정하는 지표다. 즉, 샤프는 어떤 자산의 수익률이란 무위험 수익률에다가 시장 위험을 감수하는 대가로 받는 시장 위험 프리미엄을 더한 것이라고 생각했다.

CAPM이 나온이후 사람들은 어떤 포트폴리오나 펀드 매니저의 성과를 평가할 때, 알파와 베타라는 개념으로 성과를 분해하기 시작했다. 다시 말해서, 투자 성과가 시장 전체의 움직임(베타)에 의해 발생한 것인지, 아니면 시장 움직임과 무관한 매니저의 역량(알파)에 의해 발생한 것인지를 따지기 시작한 것이다.

## APT와 멀티 팩터
1976년 미국의 경제학자 스티븐 로스는 APT(Arbitrage Pricing Theory)라고 하는 새로운 모델을 통해 기존의 CAPM이 가지고 있던 문제를 해결하고자 하였다. APT는 자산의 기대 수익률을 설명할 수 있는 변수가 시장 전체의 움직임 이외의 다른 것이 있다는 것이었다. 다시 말해서, 어떤 자산의 수익률은 여러 요인(팩터)의 선형 결합으로 설명 될 수 있다는 것이다. CAPM이 베타라는 단일 팩터를 주장했다면, APT는 멀티팩터의 가능성을 제시하였다. 

APT를 수식으로 표현하면,

$$
E(R_i) =  R_f + \sum_{k=1}^{N} \beta_k RP_k
$$

여기서 $RP_k$는 k번째 팩터의 위험 프리미엄을, $\beta_k$는 k번째 팩터의 베타를 의미한다.

로스는 이후1980년 리처드 롤과 함께 발표한 논문에서 물가, 국민총생산, 회사채 프리미엄, 그리고 금리 커브의 움직임이 주식의 수익률을 설명하는 팩터들이라고 제시했다. 

## 파마-프렌치3-팩터 모델
1993년 파마와 프렌치는 베타에 더해서 HML(High Minus Low) 팩터와 SMB(Small Minus Big) 팩터를 제시하여 파마-프렌치3-모델을 만들었다. 이들은 각각 현재 벨류 팩터와 사이즈 팩터라고 부르는 팩터들이다. 

그들은 우선 시가총액과 PBR 두가지를 이용해 수많은 주식을 총 6가지의 카테고리로 나누고 이를 다시 HML와 SMB 두가지 팩터로 표현했다. 

SMB 팩터는 시가총액에 기반해 주식 스코어를 매긴 후 소형주를 매수하고 대형주를 매도하는 시장중립 포트폴리오 였으며, HML는 PBR을 기준으로 스코어를 매긴 뒤 PBR이 작은 주식은 매수하고 큰 주식은 매도하는 시장중립 포트폴리오였다. 파마와 프렌치의 분석결과 HML와 SMB 모두 유의미한 양(+)의 프리미엄이 있으며 베타와 상관관계가 낮다는 것을 뵤여줬다.  

## 팩터 모델링의 발전
1997년 마크 카하르트는 파마-프렌치-3팩터 모델에다가 모멘텀을 추가하여 카하르트 4-팩터 모델을 제시했다. 더불어 2015년 파마와 프렌치는 기존의 모델에 기업의 수익성과 기업의 투자를 추가해 파마-프렌치-5팩터 모델을 제안했다.

이후 학계와 실무에서 수 많은 모델이 계속 등장했고 팩터의 개수는 점점 늘어났다. 캠벨 하비와 얀 리우는 2019년 연구에서 현재 시장에 알려져 있는 팩터가 대략 300종류가 넘는다고 말했다. 또한, 월드퀀트의 창업자 이고르 툴친스키는 자신의 책에서 현재 월드퀀트는 4백만개가 넘는 팩털르 보유하고 있다고 주장했다.

# 팩터 모델링의 접근방식
팩터를 만드는 방식에는 크게 연역적인 방법과 귀납적인 방법이 있다.

먼저, 이론 기반의 연역적 방식은 우리가 일반적으로 생각할 수 있는 방식이다. 이는 팩터에 대한 아이디어, 즉 가설을 먼저 떠올리는 접근법이다. 예를들어, '금리가 상승하면 주가가 하락할 것이다'라는 아이디어가 있다고 해보자. 이러한 명제는 나름 합리적인 이유가 있다. 자산가격 결정 원리에 따라서 주가는 결국 미래의 현금흐름의 현재가치이기 때문에 금리의 영향을 받을 수 밖에 없고, 따라서 금리, 즉 할인율이 상승하면 주가가 하락할 것이라는 것이다. 이렇게 명제가 완성되면 다음은 명제가 맞는지 검증해보는 것이다. 데이터 분석을 통해 이 명제가 맞다고 판단되면 이는 활용가능한 팩터가 되고, 아니면 가설은 폐지되거나 수정된다.

연역적 방식은 처음 가설을 만들어내는 사람의 주관이 개입될 수 밖에 없다는 한계를 갖는다. 다시 말해서 아이디어를 생각하는 그 순간부터 팩터를 개발하는 사람의 주관이 들어가기 때문에 객관성이 떨어지는 방식이다. 

데이터 기반의 귀납적 방식은 이와 반대다. 경험적 방식은 가설 설정 없이 먼저 통계적 기법을 통해서 데이터를 분석하여 패턴을 얻어낸 후, 만약 유의미한 패턴이 있다면 추후에 왜 그러한 패턴이 만들어졌는지 연구한다. 최근들어 각광받고 있는 머신러닝에 대한 패턴인식의 활용이 이러한 경험적 방식의 대표적인 예시다.

귀납적 방식의 문제점은 팩터의 의미를 해석하기가 쉽지 않다는 것이다. 연역적 방식으로 만들어진 팩터는 이를 설계한 논리가 분명히 존재하기 때문에 스토리텔링이 가능하다. 하지만 귀납적 방식으로 만들어진 팩터는 이것이 불가능하다. 순전히 통계로만 뽑아낸 패턴이기 때문이다. 예를들어, 주성분분석 (PCA, Principal Component Analysis), 독립성분분석(ICA, Independent Component Analysis) 혹은 기법을 사용해서 통계적으로 유의미한 패턴을 발견했다고 해보자. 문제는 이 패턴이 시장의 인과성을 설명해주지 못한다는 것이다.  

만약 어떤 팩터를 발견했다고 하면, 그 상호아에서 반드시 물어봐야 할것은 '이 팩터가 어떤 이유로 어떤 인과관계를 통해서 시장에서 돈을 벌 수 있는 기회를 줄것인가?'디. 왜냐하면 결국 인과성이 존재하지 않는다면 그것은 과거에만 우연의 일치로 맞았던 가짜 발견일 가능성이 높기 때문이다. 예를들어, 방글라데시의 버터 생산량과 미국의 S&P500 지수와의 상관관계가 0.9로 높게 나온다고 한다면, 이는 매우 높은 상관관계를 의미하짐나 그냥 우연의 일치힐 가능성이 높다. 이 둘간의 경제적 연결고리가 거의 없기 때문이다.

결국 시장에서 돈을 벌어다 주는 것은 금융시장의 메카니즘이지 딱 맞아떨어지는 과거의 패턴은 아니다. 따라서 좋은 팩터를 설계하기 위해서는 연역적 방식과 귀납적 방식을 모두 사용하는 접근법이 필요하다.

# 팩터의 구분
## 베타
베타는 시장과 함꼐 움직이는 팩터다. 일반적으로 베타는 다음과 같이 정의된다.

- 주식 베타: 글로벌 43개국에 대한 종합주가지수 평균
- 채권 베타: 글로벌 26개국에 대한 10년 만기 채권 가격 평균
- 외환 베타: 달러를 제외한 G10 국가 통화의 평균 환율
- 원자재 베타: 원자재 30개 종목에 대한 평균 가격

## 모멘텀
모멘텀은 과거에 좋은 성과를 보였던 자산은 앞으로도 더 오를 것이고, 반대로 안좋은 성과를 보였던 자산은 앞으로 떨어질 것이라는 아이디어를 반영한 팩터이다. 

시장에는 추세가 존재한다. 여기서 추세는 과거의 어떤 가격흐름이 생각보다 오래 지속되는 것을 의미한다. 만약 어떤 자산의 가격이 지금까지 상승 추세를 보였다면, 롱 포지션을 잡고, 반대로 하락 추세를 보였다면 숏을 때리는 것이 모멘텀 전략이다.

모멘텀이 작동하는 이유는 시장에 사람들의 군중심리가 녹아있기 때문이다. 많은 시장 참여자들이 앞으로 가격이 오를 것이라고 본다면, 이러한 상승 흐름은 우리가 합리적으로 생각하는 것보다 더 과도하게 오르는 경향이 있고 반대의 경우도 마찬가지다.

일반적으로 모멘텀은 다음과 같이 정의된다.

- 주식 모멘텀: 과거 12개월의 수익률
- 채권 모멘텀: 과거 12개월의 수익률
- 외환 모멘텀: 과거 12개월의 수익률
- 원자재 모멘텀: 과거 12개월의 수익률

이러한 모멘텀의 정의는 1993년 제가디쉬와 티트먼의 논문에서 처음 제시되었다. 이들의 연구 후에 시계열 모멘텀과 듀얼 모멘텀 등 다양한 방법이 나왔다.

## 벨류
벨류는 한국말로 가치를 의미한다. 주식의 벨류 팩터를 정의하는 대표적인 방법은 1992년 파마와 프렌치가 제시한 방법과 같이 PBR을 사용하는 것이다. PBR이 높으면 고평가, 반대로 낮으면 저평가라고 판단할 수 있다.

기본적으로 벨류 팩터는 평균회귀의 아이디어를 반영한 것이다. 즉, 공정 가치라고 여겨지는 어떠한 지표대비 현재의 가격 수준을 체크하여 그 둘간의 격차가 좁아질 것을 기대하는 팩터다. 

벨류 팩터는 다양하게 정의할 수 있다. 예를들어, 벨류는 다른 자산 가격과의 스프레드 같은 상대적 가치 모델이 될 수 있으며, 과거의 일정기간의 가격 범위와 비교했을 때 현재 가격이 어느수준에 위치해 있는가를 판단하는 통계적 모델이 될 수도 있다. 이러한 요인들은 자주 변하는 성질의 것이 아니므로 결국 벨류 팩터는 가격의 평균회귀에 배팅하는 것이다.

일반적으로 모멘텀 팩터와 벨류 팩터는 서로 음(-)의 관계를 보인다. 그 이윤느 서로 반대되는 성질에 기반하고 있기 때문이다.

자산군별 벨류 팩터는 다음과 같이 정의할 수 있다.

- 주식 벨류: CAPE 비율
- 채권 벨류: 10년만기 채권의 실질 금리
- 외환 벨류: 구매력 평가 기준(PPP)
- 원자재 벨류: 과거 5년 가격대비 상대적 위치

CAPE 비율은 미국의 경제학자 로버트 쉴러 교수가 만든 지표이며, 이 때문에 종종 쉴러 PER이라고도 불린다. 일반적인 PER이 개별 주식에 적용되는 기업의 수익 대비 가격 지표라고 한다면, CAPE 비율은 주식시장 전체에 적용되는 평가척도다. 

채권 벨류를 정의하는 실질 금리는 10년 만기 채권의 명목 금리에서 물가상승률을 뺀 값이다.

외환 벨류의 구매력 평가기준 (PPP, Purchasing Power Parity)는 빅맥 지수와 같이 각국의 통화가 어느 정도의 구매력이 잇는가를 측정하는 지표이다.

원자재 벨류 팩터는 과거 5년간의 통계적 모델을 통해 점수를 매긴다. 

## 캐리
캐리는 자산을 보유하고 있는 상황에서 아무런 일이 발생하지 않아도 얻을 수 있는 수익을 의미한다. 즉, 시장가격이 움직이지 않을 때에도 얻을 수 있는 수익이다.

캐리가 가지고 있는 위험은 가격 변화에 대한 리스크다. 캐리 팩터를 구현하기 위해 매수한 자산의 가격이 하락하거나, 반대로 매도한 자산의 가격이 상승하는 경우 기대했던 캐리 수익률을 넘는 손실이 발생할 수도 있다.

일반적으로 캐리는 다음과 같이 정의된다.

- 주식 캐리: 배당 수익률
- 채권 캐리: 10년 국채 수익률과 3개월 국채 수익률 간의 차이 (텀 스프레드)
- 외환 캐리: 통화별 단기 자금 금리
- 원자재 캐리: 원자재 선물과 기간 구조에 내재된 수익률

주식 캐리 전략은 배당 수익률이 높은 종목에 롱을 잡고, 반대로 낮은 종목에 숏을 때린다. 

채권 캐리는 텀 스프레드라고 불리는 10년 국채 수익률과 3개월 국채 수익률의 차이를 활용한다. 일반적으로 금리 기간구조는 만긱가 길어질수록 우상향하는 모습을 보이는데, 여기서의 채권 캐리 전략은 이 우상향하는 금리 커브를 타고 내려오는 롤다운 전략을 활용하는 것이다. 채권은 만기가 존재하고 하루하루 지남에 따라 만기가 줄어들게된다. 따라서, 만약에 시장 금리가 변하지 않아 금리 커브가 일정하게 유지된다면, 시간의 흐름에 따라 금리 커브를 타고 내려오면서 추가 적인 수익을 얻을 수 있다.

외환 캐리는 통화별 단기 자금 금리를 비교하여 고금리 통화는 롱을 잡고, 저금리 통화는 숏을 때리는 전략이다. 다시 말해, 이는 저금리 통화를 빌려 고금리 통화에 투자하는 환캐리 트레이드다. 이 환캐리 트레이드는 2000년대 초반 일본에서 초저금리가 지속되면서 엔화를 빌려서 해외 고금리 자산에 투자하는 주부 투자자들인 와타나베 부인들이 주로 사용하던 투자 방식이다.

원자재 캐리는 원자재 선물의 기간구조에 내재되어있는 수익을 얻는 전략이다. 금리 시장에는 만기에 따른 금리 기간구조가 있듯이, 원자재 선물시장 또한 선물 만기에 따른 기간구조가 존재한다. 선물 기간구조는 그 모양이 우상향이냐, 우하향이냐에 따라서 '콘탱고'와 '백워데이션' 이라고 불린다. 시장이 콘탱고라면 선물을 매도함으로써 캐리 수익을 얻을 수 있고, 반대로 백워데이션이라면 선물을 매수함으로써 캐리 수익을 얻을 수 있다. 선물의 만기가 도래하면서 선물 가격이 현물 가격에 수렴하기 때문이다.

# 백테스팅
백테스팅은 어떤 전략을 과거에 사용했다면 과연 어느 정도의 성과가 발생할 수 있었을가를 확인해보는 것이다. 백테스팅의 목적은 과거의 성과를 통해 미래의 성과를 추측해 보기 위한 것이다. 

〈주식시장은 어떻게 반복되는 가>라는 책을 쓴 피셔 인베스트먼트의 창립자 켄 피셔는 투자자라면 시장의 역사로 부터 교훈을 얻어야한다고 강조한다. 그 이유는 시장이 역사속에서 증거를 남기면서 끊임없이 반복되는 한편, 인간의 기억력은 매우 짧고 편향되기 때문이다. 

인간은 단지 보고 싶은 것을 보고, 듣고 싶은 것만 듣고, 기억을 왜곡하며 이로 인해 비이성적인 행동을 반복한다. 이러한 인간의 본성을 깨달은 켄 피셔는 그의 책에서 이렇게 말했다.

> "인류의 이러한 근시안적 성향은 우연의 결과가 아니라 진화의 소산이다. 인류는 고통을 빨리 잊도록 진화했다. 이렇게 진화하지 않았더라면 우리는 몽둥이와 돌을 들고 짐승 사냥에 나서지 않았을 것이고, 가뭄이나 우박으로 농사를 망친 후에는 밭을 갈지 않았을 것이며, 여성은 둘째 아이를 절대 낳지 않았을 것이다. 고통을 잊는 습성은 생존 본능이다. 그런데 안타깝게도 우리는 교훈마저 잊는다. 그러나 시장은 잊지 않는다. 메소포타미아 문명 초기에 사람들을 흥분시켰던 사건들은 21세기에도 똑같이 사람들을 흥분시킨다. 인간의 본성은 좀처럼 바뀌지 않으며, 바뀐 환경에 반응하는 방식 역시 마찬가지다."

각종 언론 매체에서 떠드는 주장들은 역사적으로 끊임없이 반복되어 왔으나, 이 모든 것은 과거에 들어맞았던 적이 거의 없으며 그렇기 때문에 남들이 보지 못할 때 시장을 똑바로 바라볼 수 있다면 수익을 창출할 수 있다는 것이 피셔의 주장이다.

피셔는 또 이런 말을 했다.

>"시장의 역사는 실험실이다. 가설을 검증하는 곳이다. 만약 전 세계가 X를 보고 Y를 예상하는데 당신 혼자 역사 테스트를 통해 그렇지 않다는 것을 알게 된다면, 사람들과 반대로 투자해 돈을 벌 수 있다. 더 나아가 X 다음에 무엇이 오는지를 발견할 수 있고, 무엇이 실제로 Y를 일으키는지를 찾아낼 수도 있다. 그렇게 하려면 먼저 역사를 실험실로 활용하는 방법을 배워야 한다."

퀀트가 백테스팅을 하는 이유는 역사를 잊지 않기 위함이다. 데이터는 거짓말을 하지 않기 때문이다. 

그러나 백테스팅을 할 때는 주의해야하는 위험이 있다.

## 과최적화 위험
과최적화는 과거에 성과가 잘나올수 있게끔 데이터를 억지로 끼워맞추는 것을 의미한다. 예를들어, 가격이 N일 이동평균선 위로 상승하면 매수를 하는 전략을 사용한다고 해보자. 이때 과거의 데이터로 시뮬레이션을 돌려보니 정확히 31일 이동평균선의 성과가 가장 좋았다고 해서 무턱대고 31일이라는 파라미터를 사용한다면 과최적화를 일으킬 수 있다. 왜냐하면 31일 이동평균선에서 성과가 최대로 나온 것은 결국 과거의 일일뿐이며 이 파라미터의 표본 외 성과, 즉 미래의 성과가 정말로 최대 성과일지 알 수 없기 떄문이다.

## 생존 편향 위험
오늘의 주식시장에는 오늘까지 살아남은 주식들만 거래된다. 다시 말해, 과거에는 존재했으나 상장폐지되어 사라진 주식에 대한 데이터는 누락되어 있을 가능성이 있다는 것이다. 이러한 현상이 생존편향이다. 만약 생존편향이 있는 상태에서 백테스팅을 한다면 전략의 성과가 실제보다 부풀려질 가능성이 있다. 그 이유는 살아남은 것만을 대상으로 시뮬레이션을 돌렸기 때문이다. 이러한 생존편향의 오류를 만들지 않으려면 상장폐지가 된 종목까지 모두 포함된 과거 데이터를 확보해야만 한다.

## 실제 성과와의 괴리 
마지막은 백테스팅과 실제 성과와의 괴리이다. 백테스팅을 했다고 해서 전략에 대한 검증이 끝난 것은 아니다. 향후 일정 기간 동안 백테싕 결과와 실제 트레이딩 성과가 같이 움직이는지를 모니터링 할 필요가 있다. 이렇게 백테스팅과 실제 트레이딩의 성과가 잘 맞아떨어지는지 검증하는 것을 '포워드 테스트'라고 한다. 

만약 포워드 테스트 결과가 백테스팅 결과와 같이 움직이지 않는다면, 우리는 이 백테스팅 결과를 원점에서 다시 생각해볼 필요가 있다. 괴리가 발생한다는 것은 결국 내가 트레이딩하고 있는 전략과 백테스팅 상의 전략이 서로 다른 전략이라는 것을 의미하기 때문이다.

