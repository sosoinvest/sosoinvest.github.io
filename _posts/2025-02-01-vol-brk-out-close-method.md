---
layout: single
title:  "[투자전략-14] 변동성 돌파전략 포지션 청산방법의 효과"
description: 변동성 돌파전략에서 포지션 청산방법에 따른 효과 비교
categories: 투자
tag: [주식, 퀀트]
toc: true
author_profile: false
header:
 teaser: /images/2025-02-01-vol-brk-out-close-method/total_figure_d1.webp
 og_image: /images/2025-02-01-vol-brk-out-close-method/total_figure_d1.webp
# sidebar:
#     nav: "docs"
# search: true
---
지난 글에서 다룬 [래리 윌리엄스가 추천하는 청산 기법](/투자/how-to-close-the-position)을 변동성 돌파전략에 적용해봤다. 그가 추천하는 청산기법을 정리하면 다음의 다섯가지로 요약된다.

1. 손절매
2. 시가청산
3. 포지션 전환
4. 청산 시간 제한
5. 과매수 기준일 조정

기본적인 변동성 돌파전략은 매수 후 익일 시가에 청산하므로 손절매를 고려할 필요가 없을 것으로 보인다. 래리 윌리엄스도 매수 당일에는 손절매를 적용하지 말라고 [그의 책](/투자/long-term-secret-to-short-term-trading)에서 언급하기도 했다. 또한 현물만 거래하는 경우 포지션 전환도 고려할 필요가 없다. 마지막 과매수 기준일 조정 또한 적용하지 않는다면, 두번쨰 시가청산과 네번째 청산 시간 제한만 남는다. 

여기서는 두번쨰 청산 규칙 **익절 가능한 시가에 청산**과, 네번째 청산규칙 **매수 후 n일 지난 후 시가 청산**의 효과를 백테스트로 분석해 봤다. 래리 윌리엄스는 이 청산기법을 구제형 이익실현 기법이라고 이름 붙였다.

# 백테스트 조건
- 백테스트 대상: [KODEX 코스닥150](https://finance.naver.com/item/main.naver?code=229200)

- 백테스트 기간: 2015.10.01 ~ 2025.01.24

- 세금: 0%
: *국장 ETF이기 때문에 거래세와 양도세가 없다.

- 거래 수수료: 0.0036%
: *한국투자증권 계좌의 국내주식 거래 수수료를 적용했다.

## 계산 조건
**변동성 돌파전략**의 매매조건은 아래와 같다.

<div class="notice--primary">
<ul>
    <li style="font-size: 1.25em;">전일 고가에서 저가를 빼서 변동폭을 구한다.</li>
    <li style="font-size: 1.25em;">시가+K*변동폭으로 타겟 매수가를 정하고, 오늘 장중 가격이 이 가격을 초과하면 매수한다.</li>
    <li style="font-size: 1.25em;">익절가능한 시가 또는 n일 이후 시가에 모두 매도한다.</li>
</ul>
</div>

변동성 돌파전략의 자세한 것은 다음 글들을 참고하기 바란다.

- [래리 윌리엄스의 변동성 돌파전략 (파이썬 코드 있음)](/투자/volatility-break-out-strategy/)
- [절대로 지지않는 롱 전략](/투자/never-losing-long-strategy)
- [곱버스를 우상향시키는 방법](/투자/upward-sloping-inverse-double)

# 백테스트 결과
변동성 돌파 전략에서는 두가지 파라미터를 고려해야한다. 변동성 돌파계수 K와 청산시간 제한일 n일이다. 여기서는 K를 0.1부터 0.8까지 0.1 간격으로 총 8가지 케이스, n을 1일부터 4일까지 총 4가지 케이스를 고려했다.

아래의 표는 변동성 돌파전략을 백테스트한 모든 경우의 결과이다. 
Buy and hold의 결과는 최종 수익률 21.32%, MDD -57.22%, 샤프지수 -0.19이다.

*표 1: 돌파계수 K와 청산 제한 시간 n일에 따른 변동성 돌파전략 백테스트 결과*

| n | K | 최종 수익률 | MDD | CAGR |매매일수 |승률 |평균 수익률 |평균 손실율 |RR비율 |샤프지수 |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|1 |0.1|316.54%|-46.47%|11.5%|1747|53.23%|1.15%|-0.72%|1.6|0.51|
| |0.2|365.38%|-33.84%|14.14%|1576|54.25%|1.09%|-0.57%|1.91|0.71|
| |0.3|443.67%|-25.4%|17.21%|1319|56.25%|1.04%|-0.4%|2.6|0.98|
| |0.4|381.76%|-18.51%|16.47%|1103|57.03%|1.0%|-0.29%|3.45|1.07|
| |0.5|363.56%|-16.11%|16.68%|915|57.05%|0.97%|-0.21%|4.62|1.25|
| |0.6|375.1%|-20.68%|17.47%|738|59.35%|0.93%|-0.14%|6.64|1.51|
| |0.7|201.23%|-20.71%|11.96%|612|58.01%|0.9%|-0.11%|8.18|1.15|
| |0.8|152.79%|-16.77%|9.98%|499|58.92%|0.89%|-0.09%|9.89|1.05|
|2 |0.1|209.99%|-49.48%|7.38%|1858|45.91%|1.1%|-0.6%|1.83|0.32|
| |0.2|241.14%|-41.07%|9.46%|1714|46.5%|1.06%|-0.51%|2.08|0.44|
| |0.3|459.3%|-29.63%|16.88%|1475|48.41%|1.03%|-0.38%|2.71|0.89|
| |0.4|427.93%|-26.37%|16.79%|1282|49.92%|0.99%|-0.3%|3.3|0.96|
| |0.5|400.69%|-27.47%|16.78%|1088|51.01%|0.96%|-0.22%|4.36|1.06|
| |0.6|434.07%|-19.43%|18.47%|908|52.86%|0.92%|-0.16%|5.75|1.39|
| |0.7|376.12%|-17.73%|17.46%|772|52.2%|0.92%|-0.12%|7.67|1.51|
| |0.8|285.03%|-12.19%|15.04%|649|51.77%|0.9%|-0.09%|10.0|1.47|
|3 |0.1|187.43%|-53.8%|5.97%|1899|41.13%|1.07%|-0.51%|2.1|0.25|
| |0.2|370.44%|-42.32%|13.44%|1769|41.83%|1.03%|-0.41%|2.51|0.63|
| |0.3|304.84%|-35.55%|12.48%|1563|42.74%|1.01%|-0.35%|2.89|0.64|
| |0.4|221.42%|-40.77%|9.74%|1381|44.46%|1.0%|-0.31%|3.23|0.5|
| |0.5|243.22%|-37.68%|11.15%|1193|45.26%|0.97%|-0.24%|4.04|0.62|
| |0.6|343.42%|-23.72%|15.3%|1008|47.32%|0.94%|-0.17%|5.53|0.99|
| |0.7|286.92%|-23.89%|14.14%|862|46.98%|0.94%|-0.14%|6.71|1.03|
| |0.8|220.33%|-20.26%|12.12%|731|46.51%|0.94%|-0.11%|8.55|0.97|
|4 |0.1|172.92%|-51.48%|5.32%|1925|37.71%|1.05%|-0.45%|2.33|0.22|
| |0.2|257.17%|-43.0%|9.59%|1815|38.18%|1.01%|-0.38%|2.66|0.43|
| |0.3|234.25%|-42.94%|9.53%|1608|39.8%|0.99%|-0.33%|3.0|0.46|
| |0.4|273.4%|-39.84%|11.83%|1435|41.32%|0.97%|-0.28%|3.46|0.63|
| |0.5|373.01%|-28.89%|15.8%|1245|42.57%|0.93%|-0.2%|4.65|0.97|
| |0.6|356.95%|-31.25%|15.44%|1057|44.84%|0.91%|-0.16%|5.69|0.96|
| |0.7|282.27%|-31.56%|13.75%|918|43.68%|0.91%|-0.13%|7.0|0.95|
| |0.8|231.25%|-27.24%|12.59%|783|43.3%|0.92%|-0.1%|9.2|1.02|

위의 결과를 살펴보면,

- K값이 증가할 수록 승률과 RR 비율이 증가하고 MDD가 낮아진다. 그러나 매매 횟수가 적어져서 CAGR은 낮아진다.

- 최종 수익률이 가장 높은 경우는 n=2, K=0.3이다. 그러나 n=1, K=0.3과 큰 차이는 없다.

- n이 커질수록 MDD도 증가하는 모습을 보인다. 그 이유는 위험에 더 오래노출 되기 때문이다.

- 결과적으로 코스닥 150에 대해서는 과거 10년 데이터를 기반으로 테스트 했을 떄, 구제형 청산기법이 잘 작동하지 않았다.

## 백테스트 수익 곡선 

<p align="center">   
    <img src="/images/2025-02-01-vol-brk-out-close-method/total_figure_d1.webp" alt="n=1인 경우의 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 1 백테스트 결과 n = 1</span>
</p>

<p align="center">   
    <img src="/images/2025-02-01-vol-brk-out-close-method/total_figure_d2.webp" alt="n=2인 경우의 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 2 백테스트 결과 n = 2</span>
</p>

<p align="center">   
    <img src="/images/2025-02-01-vol-brk-out-close-method/total_figure_d3.webp" alt="n=3인 경우의 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 3 백테스트 결과 n = 3</span>
</p>

<p align="center">   
    <img src="/images/2025-02-01-vol-brk-out-close-method/total_figure_d4.webp" alt="n=4인 경우의 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 4 백테스트 결과 n = 4</span>
</p>