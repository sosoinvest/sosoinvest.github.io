---
layout: single
title:  "곱버스를 우상향시키는 방법"
description: 곱버스를 우상향시킬 수 있는 변동성 돌파전략 매매법을 정리한 글
categories: 투자
tag: [주식,퀀트,백테스트,파이썬]
toc: true
author_profile: false
header:
 teaser: /images/2024-11-12-upward-sloping-inverse-double/kosdaq-inverse.webp
 og_image: /images/2024-11-12-upward-sloping-inverse-double/kosdaq-inverse.webp

# sidebar:
#     nav: "docs"
# search: true
---
> 곱버스도 국장이다.

곱버스에 들어가도 우상향 시킬 수 있는 매매법이 있다.

어디서 본 비유인데, 공매도, 즉 숏(Short)은 "기찻길에서 동전을 줍는 것"과 같다고 한다. 벤저민 그레이엄, 워런 버핏, 피터 린치 같은 위대한 투자자 중 한 명의 책에서 읽은 표현이다. 주식은 기본적으로 우상향하는 특성을 가지고 있기 때문에, 장기적으로 보면 숏 포지션은 불리할 수밖에 없다.

주식이 우상향하는 이유는 제레미 시겔의 해석에 따르면 주가에 인플레이션이 반영되기 때문이다. 피터 린치 역시 비슷한 설명을 한다. 인플레이션으로 제품 가격이 오르면 회사의 매출이 증가하고, 매출이 늘어난 만큼 배당도 늘어나므로 주가가 상승하게 된다는 것이다.

그러나 이러한 주가의 우상향 기대는 국내 주식 시장에서는 통하지 않는다. 대주주가 굳이 주가를 올릴 필요가 없기 때문에, 회사의 이익이 주주에게 돌아오는 경우가 거의 없다. 그래서 코스피가 십수 년째 2000선에서 벗어나지 못하고 있는 것이다.

트레이딩 관점에서 보면 이러한 상황이 꼭 나쁜 것만은 아니다. 주가가 조금만 올라줘도 숏 포지션으로 수익을 낼 수 있기 때문이다. 여기서는 숏 포지션으로 수익을 극대화할 수 있는 매매법을 살펴보려 한다.

이전에 알아본 [래리 윌리엄스의 변동성돌파 전략](/투자/never-losing-long-strategy)을 그대로 국내 주식 시장의 인버스 ETF에 적용해 백테스트하고, 그 결과를 정리했다. 이 전략은 추세 추종 전략의 일종으로, 일단 추세가 형성되면 그 추세를 그대로 따라가는 방식이기 때문에 롱이든 숏이든 모두 유효할 것으로 판단했다.

# 백테스트 조건
- 백테스트 대상: 코스피200인버스([KODEX인버스](https://m.stock.naver.com/domestic/stock/114800/total)), 코스피200곱버스([KODEX200선물인버스2X](https://m.stock.naver.com/domestic/stock/252670/total)), 코스닥150인버스([KODEX코스닥선물인버스](https://m.stock.naver.com/domestic/stock/251340/total)), 
: *국장에 상장된 인버스 및 곱버스 ETF를 대상으로했다.

- 백테스트 기간: 2014.11.11 ~ 2024.11.12
: *최근 10년 (ETF가 상장한지 10년이 되지 않은 경우에는 상장일부터 2024.11.12까지를 기간으로 잡았다.)

- 세금: 0%
: *거래세와 ETF의 배당소득세는 계산에서 제외했다.

- 거래 수수료: 0%
: *거래수수료는 계산에서 제외했는데, 증권사들이 경쟁적으로 수수료를 내리고 있어서 거의 영향을 미치지 않는다.

## 계산 조건
복습하면, 변동성 돌파전략의 매매조건은 아래와 같다.

<div class="notice--primary">
<ul>
    <li style="font-size: 1.25em;">전일 고가에서 저가를 빼서 변동폭을 구한다.</li>
    <li style="font-size: 1.25em;">시가+K*변동폭으로 타겟 매수가를 정하고, 오늘 장중 가격이 이 가격을 초과하면 매수한다.</li>
    <li style="font-size: 1.25em;">다음날 시가에 모두 매도한다.</li>
</ul>
</div>

여기서 K값은 신호의 발생빈도를 조절하는 수치인데, 보통 0.5로 잡는다. 0.5보다 낮으면 거래가 자주 일어나지만 승률이 낮아지고, 높으면 드물게 일어나면서 승률이 높아진다. 

[백테스트 코드 구성의 자세한 내용은 지난글을 참고바란다.](/투자/volatility-break-out-strategy/)

# 백테스트 결과
아래의 표는 백테스트한 모든 ETF에 최근 10년간(2014.11.11~2024.11.12) 변동성 돌파전략을 적용한 결과이다. 여기서는 K값은 0.5로 고정한 후 서로 다른 ETF간의 결과를 비교했다.

*표 1: 변동성 돌파전략 백테스트 결과 (K=0.5)*

| 구분 | KODEX인버스 | KODEX200선물인버스2X | KODEX코스닥선물인버스 |
|:---:|:---:|:---:|:---:|
| 최종 수익률 | <span style="color: blue;">-13.3%</span> | <span style="color: red;">34.4%</span> | <span style="color: red;">79.3%</span> |
| Buy and hold | <span style="color: blue;">-44.3%</span> | <span style="color: blue;">-76.5%</span> | <span style="color: blue;">-62.9%</span> |
| CAGR | -2.1% | 0.8% | 6.0% |
| MDD | -30.6% | -38.6% | -31.0% |
| 매매일수  | 765 | 610 |  627 |
| 승률  | 45.1% | 46.7% | 50.1% |
| 수익 시 평균 수익률 | 0.7% | 1.45% |  1.08% |
| 손해 시 평균 손실률  | -0.65% | -1.28% | -0.96% |
| RR비율 | 1.08 | 1.13 | 1.13 |
| 샤프지수  | -0.26 | 0.05 | 0.48 |
| 샤프지수(Buy and hold)  | -0.50 | -0.75 | -0.65 |

결과를 보면, KODEX 인버스는 최종 수익률이 -13.3%로 손실을 기록했지만, KODEX 200선물 인버스 2X와 KODEX 코스닥 선물 인버스는 각각 34.4%와 79.3%의 수익을 냈다. KODEX 인버스가 손실을 기록하긴 했지만, 매수 후 보유 전략(Buy and Hold)과 비교했을 때는 모든 경우에서 더 나은 성과를 보였다.

연평균 복리 수익률(CAGR)을 보면, KODEX 인버스는 -2.1%, KODEX 200선물 인버스 2X(곱버스)는 0.8%, KODEX 코스닥 선물 인버스는 6.0%로, KODEX 코스닥 선물 인버스의 성과가 가장 높았다. 코스피보다 코스닥의 성과가 더 높은 이유는 지난 10년간 코스닥의 변동성이 코스피보다 더 컸기 때문으로 보인다.

그림을 보면, KODEX 인버스와 곱버스의 손실은 대부분 2022년부터 최근 2년 사이에 발생했다. 이 기간 동안 코스피 지수는 2500선에서 크게 오르지도 내리지도 않았는데도 손실이 발생한 것을 보면, 변동성이 큰 장세에서는 숏 포지션으로 수익을 내기가 쉽지 않다는 것을 알 수 있다. 이는 주가가 하락하는 추세는 비교적 짧게 유지되는 반면, 상승하는 추세는 더 오래 지속되는 경향 때문으로 보인다. 

상승 추세는 길고 하락 추세는 짧다는 설명은 아래의 격언과 들어맞는 결과이다.
>["상승할 때는 쌓아 올리고 하락할 때는 무너진다"](/투자/trading-edge-book-in-out-rule/#매수-밖에-하지-못하는-시장과-종목)

최대 낙폭(MDD)을 살펴보면, 코스피, 코스닥, 곱버스 모두 약 30% 수준으로 비슷한 수준의 손실 위험을 보였다.

승률은 코스피에서 약 45%, 코스닥에서 약 50%로, 코스닥이 더 나은 성과를 보였다. 50% 이하의 승률에서 수익을 내려면 [RR 비율(=평균 수익률/평균 손실률)](/투자/trading-edge-book)이 약 1.1 이상이어야 하는데, KODEX 인버스는 이 조건을 충족하지 못했다.

샤프지수는 전부 1미만으로 형편없었다. 

아래의 그림은 모든 백테스트 결과를 종합한 것이다. 

<p align="center">   
    <img src="/images/2024-11-12-upward-sloping-inverse-double/inverse-total.webp" alt="인버스 전체  백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 1 전체 백테스트 결과; K는 0.5로 모두 동일하다. </span>
</p>

## 코스피
### 인버스(-1x)
아래 그림은 KODEX 인버스의 백테스트 결과를 나타낸다. 여기서는 K값을 0.3부터 0.1 간격으로 0.7까지 총 5가지 케이스로 설정해 테스트를 진행했다.

K값에 따라 최종 성과가 확연히 달라졌는데, K값이 0.5 이하일 때는 최종 수익률이 마이너스를 기록했으며, 0.5 이상일 때는 소폭이나마 수익이 발생했다. 가장 성과가 좋았던 K값은 0.7로, 10년간 29.8%의 수익률을 기록했다. 이는 연평균 복리 수익률(CAGR)로 환산하면 2.3%로, 은행 예금 이자보다 낮은 수준이다.

이 결과는 변동성 돌파 전략을 코스피 인버스에 적용할 때 높은 K값이 필요하다는 점을 보여준다. 즉, 잦은 매매보다는 큰 하락 신호가 발생했을 때만 진입하는 것이 수익을 얻을 수 있는 방법이다.

매수 후 보유 전략과 비교했을 때, 최종 수익률과 최대 낙폭(MDD)은 더 나았지만, 여전히 손실을 보는 경우가 많아 전략의 유의미한 성과를 기대하기는 어려웠다.

<p align="center">   
    <img src="/images/2024-11-12-upward-sloping-inverse-double/kodex200-inverse.webp" alt="코스피200 인버스 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 2 KODEX인버스 백테스트 결과</span>
</p>

*표 2: KODEX인버스 변동성 돌파전략 백테스트 결과*

| 구분 | K=0.3 | K=0.4 | K=0.5 | K=0.6 | K=0.7 |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 최종 수익률 | <span style="color: blue;">-27.4%</span> | <span style="color: blue;">-25.6%</span> | <span style="color: blue;">-13.3%</span> | <span style="color: red;">5.6%</span> | <span style="color: red;">29.8%</span> |
| Buy and hold | <span style="color: blue;">-44.3%</span> | <span style="color: blue;">-44.3%</span> | <span style="color: blue;">-44.3%</span> | <span style="color: blue;">-44.3%</span> | <span style="color: blue;">-44.3%</span> |
| CAGR | -4.2% | -3.9% | -2.1% | 0.03% | 2.3% |
| MDD | -30.6% | -34.7% | -30.6% | -31.2% | -19.0% |
| 매매일수  | 944 | 859 |  765 | 675 |  599 |
| 승률  | 47.8% | 46.2% | 45.1% | 48.0% | 49.1% |
| 수익 시 평균 수익률 | 0.7% | 0.7% |  0.7% | 0.66% |  0.66% |
| 손해 시 평균 손실률  | -0.7% | -0.7% | -0.65% | -0.61% | -0.56% |
| RR비율 | 1.00 | 1.00 | 1.13 | 1.08 | 1.18 |
| 샤프지수  | -0.42 | -0.41 | -0.26 | 0.00 | 0.34 |
| 샤프지수(Buy and hold)  | -0.50 | -0.50 | -0.50 | -0.50 | -0.50 |

### 곱버스(-2x)
아래 그림은 곱버스에 변동성 돌파 전략을 적용한 결과이다. 인버스와 달리, 여기서는 K=0.4에서 수익률이 32.4%로 가장 높았다. K값이 0.5보다 높은 경우에는 오히려 최종적으로 손실이 발생하기도 했는데, 이는 K값이 높을수록 수익률이 좋아졌던 코스피 인버스의 결과와는 전혀 다른 양상이다.

이처럼 인버스와 다른 결과가 나타난 이유는 레버리지 ETF의 괴리율, 변동성 끌림 효과, 그리고 비용 등에서 비롯된 것으로 보인다.

또한, 표에서 확인할 수 있듯이, 최종 수익률이 플러스임에도 불구하고 CAGR이 마이너스로 산출되는 경우가 있었는데, 이는 변동성이 큰 일간 수익률을 연환산하는 과정에서 발생한 결과이다.

<p align="center">   
    <img src="/images/2024-11-12-upward-sloping-inverse-double/kodex-2x-inverse.webp" alt="코스피200 곱버스 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 3 KODEX200선물인버스2X 백테스트 결과 </span>
</p>

*표 2: KODEX200선물인버스2X 변동성 돌파전략 백테스트 결과*

| 구분 | K=0.3 | K=0.4 | K=0.5 | K=0.6 | K=0.7 |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 최종 수익률 | <span style="color: red;">11.9%</span> | <span style="color: red;">33.7%</span> | <span style="color: red;">32.4%</span> | <span style="color: blue;">-2.9%</span> | <span style="color: blue;">-17.4%</span> |
| Buy and hold | <span style="color: blue;">-76.5%</span> | <span style="color: blue;">-76.5%</span> | <span style="color: blue;">-76.5%</span> | <span style="color: blue;">-76.5%</span> | <span style="color: blue;">-76.5%</span> |
| CAGR | -3.4% | -0.3% | 0.8% | -2.7% | -4.4% |
| MDD | -55.7% | -42.1% | -38.6% | -49.5% | -50.2% |
| 매매일수  | 770 | 684 |  610 | 560 |  496 |
| 승률  | 49.5% | 48.5% | 46.7% | 47.1% | 46.6% |
| 수익 시 평균 수익률 | 1.43% | 1.43% |  1.45% | 1.37% |  1.33% |
| 손해 시 평균 손실률  | -1.42% | -1.35% | -1.28% | -1.28% | -1.29% |
| RR비율 | 1.00 | 1.06 | 1.13 | 1.07 | 1.03 |
| 샤프지수  | -0.15 | -0.01 | 0.05 | -0.18 | -0.31 |
| 샤프지수(Buy and hold)  | -0.75 | -0.75 | -0.75 | -0.75 | -0.75 |

## 코스닥
### 인버스(-1x)
아래 그림은 코스닥 인버스에 변동성 돌파 전략을 적용한 결과를 보여준다. 모든 K값에서 최종적으로 수익이 발생했다.

가장 높은 수익률을 기록한 경우는 K=0.4로, 8년간 132.9%의 수익률을 달성했다. 이를 CAGR로 환산하면 9.1%에 해당한다. K=0.4를 기준으로 더 낮거나 높은 값에서는 수익률이 감소했다.

이 결과는 코스닥 인버스에서는 평균보다 조금 더 잦은 매매를 해야 유리했음을 보여준다.

<p align="center">   
    <img src="/images/2024-11-12-upward-sloping-inverse-double/kosdaq-inverse.webp" alt="코스닥150 인버스 백테스트 결과">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 4 KODEX코스닥선물인버스 백테스트 결과 </span>
</p>

*표 2: KODEX코스닥선물인버스 변동성 돌파전략 백테스트 결과*

| 구분 | K=0.3 | K=0.4 | K=0.5 | K=0.6 | K=0.7 |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 최종 수익률 | <span style="color: red;">72.5%</span> | <span style="color: red;">132.9%</span> | <span style="color: red;">79.3%</span> | <span style="color: red;">24.5%</span> | <span style="color: red;">40.2%</span> |
| Buy and hold | <span style="color: blue;">-62.9%</span> | <span style="color: blue;">-62.9%</span> | <span style="color: blue;">-62.9%</span> | <span style="color: blue;">-62.9%</span> | <span style="color: blue;">-62.9%</span> |
| CAGR | 4.7% | 9.1% | 6.0% | 1.4% | 3.1% |
| MDD | -40.7% | -26.1% | -31.0% | -33.1% | -24.5% |
| 매매일수  | 768 | 702 |  627 | 565 |  490 |
| 승률  | 50.8% | 50.4% | 50.1% | 50.6% | 52.4% |
| 수익 시 평균 수익률 | 1.12% | 1.13% |  1.08% | 1.02% |  1.00% |
| 손해 시 평균 손실률  | -1.03% | -0.94% | -0.96% | -1.00% | -0.97% |
| RR비율 | 1.09 | 1.20 | 1.13 | 1.02 | 1.03 |
| 샤프지수  | 0.30 | 0.60 | 0.40 | 0.11 | 0.29 |
| 샤프지수(Buy and hold)  | -0.65 | -0.65 | -0.65 | -0.65 | -0.65 |

# 결론
백테스트 결과를 요약하자면,
- 롱 전략과 달리, 숏에 변동성 돌파 전략을 적용했을 때는 손실이 발생할 수 있다.
- 그 이유는 하락 추세는 상승 추세보다 상대적으로 짧게 유지되기 때문이다.
- 전략의 최종 수익과 손실은 K값에 따라 달라지지만, 그 결과는 일관적이지 않았다.
- 코스닥 인버스에 적용했을 때 가장 좋은 성과를 보였으며, 이때 최적의 K값은 0.4였다.
- 모든 경우에서 매수 후 보유 전략보다 샤프 지수는 높았고 최대 낙폭(MDD)은 낮았다.
- 전략의 성과가 고르지 못한 이유는 국내 주식시장의 지수가 일관된 추세를 보이지 않고 변동성이 크기 때문인 것으로 보인다.