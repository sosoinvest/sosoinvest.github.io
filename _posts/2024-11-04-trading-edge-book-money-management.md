---
layout: single
title:  "실전 추세투자법(1/6): 자금관리"
description: 실전 추세투자법 책의 자금관리 부분을 정리한 글
categories: 투자
tag: [주식,퀀트,책]
toc: true
author_profile: false
header:
 teaser: /images/2024-11-04-trading-edge-book-money-management/max-risk.webp
 og_image: /images/2024-11-04-trading-edge-book-money-management/max-risk.webp

# sidebar:
#     nav: "docs"
# search: true
---
> **자금관리: 자신의 트레이딩 자금을 명확히 하고, 파산하지 않는다는 전제로 이를 최대한 효율적으로 운용하는 것**

[실전 추세투자법](/투자/trading-edge-book)에서는 올바른 자금관리를 '파산하지 않는 범위에서 자금 효율을 최대화하는 것'으로 정의한다. 저자는 터틀 트레이딩이 성공한 이유를 매매 타이밍을 잡는 진입규칙보다는 자금관리와 리스크관리에 있다고 주장한다.

여기서는 구체적으로 터틀 트레이딩의 예를 들어서 그들이 실천한 자금관리와 리스크 관리 방법을 정리하였다.

자금관리법은 다음의 세단계로 이루어진다.
1. 거래하려는 종목의 가격 변동폭을 파악한다.
2. 자신의 트레이딩 자금을 정확히 파악한다.
3. 이를 바탕으로 그 종목의 1회당 거래량을 결정한다.

이와 같은 순서로 산출한 어느 종목의 1회당 적정한 거래량을 터틀은 **유닛**이라고 불렀다. 

터틀의 트레이딩 규칙은 1회의 트레이딩에서 전체 자금의 1%에 해당하는 리스크를 취한다는 것이다. 여기서 리스크 1%는 그 종목이 매매 방향과 반대로 움직일 경우 발생하는 손실을 최대 1%까지만 부담한다는 것이다.

터틀은 어떤 방식으로 유닛을 산출했을까? 이를 구하기 위해서는 **ATR** 개념이 필요하다.

# ATR(Average True Range)개념
**ATR**은 **Average True Range**의 약자로, '실제 가격 변동폭의 평균값'을 뜻한다. 여기서 **TR(True Range)**은 1일 최대 가격 변동폭을 의미한다.

## TR(True range)
TR을 최초로 제안한 사람은 [웰스 와일더 (J. Welles Wilder Jr.)]((https://en.wikipedia.org/wiki/J._Welles_Wilder_Jr.))다. 그는 파라볼릭, DMI, RSI 등 기술적 분석에서 사용하는 지표들을 탄생시킨 기술적 지표의 아버지로 불린다. 1935년 미국의 테네시주에서 태어나서 안타깝게도 2021년 85세의 나이로 세상을 떠났다.

TR의 계산에는 아래의 세가지 변동폭이 필요하다.

- $A = 당일고가 - 전일종가$
- $B = 전일종가 - 당일시가$
- $C = 당일고가 - 당일저가$

이렇게 A, B, C를 구해서, 그 중 최댓값을 그 날의 최대 리스크를 의미하는 1일 최대 가격변동폭, 즉, TR로 정의한다.

수식으로 표현하면,

$$
TR=max(A,B,C).
$$

아래의 그림은 가격 변동폭, A, B, C를 표현한 것이다.

<p align="center">   
    <img src="/images/2024-11-04-trading-edge-book-money-management/TR-concept.webp" alt="TR계산에서 사용되는 가격 변동폭을 표현하는 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 1 TR계산의 가격 변동폭 A,B,C (출처: 실전 추세투자법) </span>
</p>

이렇게 산출한 TR을 여러날에 걸쳐서 평균한 것이 ATR, 즉, TR의 평균 값이다.

평균의 방법에는 단순평균, 수정이동평균, 그리고 지수이동평균이 있다.

## 단순평균(SMA, Simple Moving Average)
단순평균은 과거 20영업일을 거슬러 올라가서 각각 TR을 산출한 뒤 모두 더해 TR의 개수, 즉 20으로 나누어 구한다.

$$
ATR_{SMA}=\frac{1}{20}\sum_{i=1}^{20}TR_{i}
$$

## 수정이동평균(MMA, Modified Moving Average)
ATR을 만든 웨스 와일더는 단순이동평균이 아닌 수정이동평균을 사용했다. 수정이동평균은 당일의 TR에 가중치를 주는 이동평균이다. 

이를 수식으로 표현하면,

$$
ATR_{MMA}=\frac{1}{20}(ATR_{yesterday}\times 19 + TR_{today})
$$

터틀은 초기에는 수정이동평균을 사용했는데 나중에는 지수이동평균으로 전향했다.

## 지수이동평균(EMA, Exponential Moving Average)
지수이동평균은 수정이동평균과 근본적인 개념은 같다. 다만 당일의 값에 가중치를 더 준다는 점에서 차이가 있다.

지수이동평균은 다음과 같은 식으로 구한다.

$$
ATR_{EMA}=\frac{1}{21}(ATR_{yesterday}\times 19 + TR_{today}\times 2)
$$

수정이동평균을 계산하는 식과 비교하면, 분모와 당일 TR의 가중치가 다르다. 지수이동평균은 당일의 데이터에 수정 이동평균보다 더 큰 비중을 부여한다. 이렇게 하는 이유는 시간이 흐르면 흐를수록 먼 과거의 가격은 영향력을 잃기 떄문이다.

## ATR의 계산 예시
아래 그림은 2013년 9월 도쿄거래소의 금 시세로 계산한 ATR의 예시를 보여준다.

<p align="center">   
    <img src="/images/2024-11-04-trading-edge-book-money-management/ATR-example.webp" alt="ATR의 계산 에시">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 2 도쿄 거래소의 금 시세로 계산한 ATR 계산 예 (출처: 실전 추세투자법) </span>
</p>

# 유닛: 1회 트레이딩 규모

## 터틀의 유닛 계산법

<div class="notice--primary">
<ul>
    <li style="font-size: 1.25em;">트레이딩 자금의 1% (A)를 구한다.</li>
    <li style="font-size: 1.25em;">그 종목을 최소 거래단위로 트레이딩 할 때 해당하는 리스크(B)를 계산한다.</li>
    <li style="font-size: 1.25em;">A를 B로 나눈다. (거래단위에 따라서 반올림한다.)</li>
</ul>
</div>

$$
A=트레이딩 자금\times 0.01
$$

$$
B=거래단위\times ATR
$$

$$
유닛=\frac{A}{B}
$$

예를 들어, 투자자금 1억원을 가진 트레이더의 어떤 자산을 대상으로 유닛을 계산했을 때 130만원이 산출되었다고 해보자. 이것은 130만원만 거래할 수 있다는 의미가 아니다. 130만원을 1유닛으로 하여, 그 단위로 거래한다는 의미한다. 130만원에 매수한 다음 포지션을 추가할 기회가 오면 거래량을 늘리는 것도 가능하다. 물론 다른 종목도 동시에 거래할 수 있다. 이때 모든 거래는 유닛 단위로 한다.

다만 거래량을 늘리는 데에는 한계가 있다. 터틀의 자금관리에는 두가지 포인트가 있는데, 하나는 1회당 거래량을 적정하게 설정하는 것이고, 다른 하나는 최대 거래량을 적정하게 설정하는 것이다.

## 1유닛이 취하는 최대 리스크
최대 리스크는 아래의 식을 통해 구한다.

$$
최대 리스크 = 유닛 수\times 거래단위 \times ATR 
$$

<p align="center">   
    <img src="/images/2024-11-04-trading-edge-book-money-management/max-risk.webp" alt="최대 리스크 설정 방법을 설명한 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 3 최대 리스크 설정 (출처: 실전 추세투자법) </span>
</p>

아래의 그림은 트레이딩하는 다양한 자산에 대해 산출한 유닛 당 최대 리스크를 보여준다.

<p align="center">   
    <img src="/images/2024-11-04-trading-edge-book-money-management/max-risk-table.webp" alt="유닛 당 최대 리스크 산출표">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 4 다양한 자산의 유닛당 최대 리스크 산출표 (출처: 실전 추세투자법) </span>
</p>

그림에서 보이듯이, 유닛이라는 개념에 기반해서 거래하는 한, 어떤 종목을 트레이딩 하더라도 1유닛의 리스크는 거의 비슷하며 트레이디 자금의 1%에 맞춰진다.

같은 종목이라도 트레이딩 자금이 다른 트레이더는 1유닛에 해당하는 거래량이 달라진다. 또한, 같은 종목이라도 가격 변동폭이 큰 시기와 작은 시기에는 1유닛에 해당하는 거래량이 달라진다. 이러한 이유로 ATR은 매일 계산할 필요가 있다. 참고로 터틀은 주 단위로 유닛을 갱신했다.

# 터틀의 리스크 분산법
 자금관리는 트레이딩 1회당 적정한 거래량을 정하는 것에서 시작한다. 그 다음은 적정한 총 거래량을 확정하는 것이다. 터틀은 특정 종목을 한번에 10유닛만큼 거래하는 일은 없었다. 그런 트레이딩은 리스크를 너무 높이기 떄문이다. 
 
## 종목분산규칙
포지션을 여러 종목으로 분산시키면 그 모든 종목에서 손실이 나기란 어렵기 때문에 패율을 상당히 낮출 수 있다. 터틀은 구체적으로 다음과 같은 종목분산규칙을 사용했다.

### 규칙 1: 동일 종목은 4유닛까지
매수 후 상승세가 이어져 추가 매수를 하는 경우에는 4유닛을 상한선으로 한다. 4유닛에 도달하면 그 후 아무리 좋은 매수 기회가 나타나도 추가 매수해서는 안된다. 

### 규칙 2: 상관관계가 높은 종목은 6유닛까지
높은 상관관계를 가진 종목은 거래 시점을 분산한다고 해도 리스크 분산 효과를 얻을 수 없다. 상관관계가 높은 종목을 트레이딩하는 경우에는 1유닛씩 추가하여 총 6유닛으로 끝낸다.

<p align="center">   
    <img src="/images/2024-11-04-trading-edge-book-money-management/corr-unit.webp" alt="높은 상관관계를 갖는 종목의 트레이딩 예시 그림">
    <br>
   <span style="font-style: italic; color: #FFFFFF;">Fig. 5 높은 상관관계를 갖는 종목의 트레이딩 예시 (출처: 실전 추세투자법)</span>
</p>

### 규칙 3: 상관관계가 있는 종목은 10유닛까지
약한 상관관계가 있는 종목은 최대 10유닛까지 거래한다.

### 규칙 4: 같은 포지션(매수라면 매수, 매도라면 매도)으로는 12유닛까지
